# Веб Сервер

## Вступление
Имплементация простого веб сервера

## Установка

Клонируйте данный репозиторий с **GitHub**:

```
mkdir ~/web_server
cd ~/web_server
git clone https://github.com/TwITe/Web-Server.git
```

## Запуск веб-сервера:

1. Перед запуском сервера создайте вектор, который будет хранить веб хандлеры, обрабатывающие запросы:
```c++
vector<webserver::web_handler> handlers;
```
2. Создайте необходимые обработчики

**Создание обработчика:**
 - Создайте функцию, которая будет преобразовывать request в response
```c++
    function<webserver::http_response(webserver::http_request)> index_handler = [&](webserver::http_request request) {
        webserver::http_response response;

        string response_body = "Hello, World!";

        response.set_response_body(response_body);
        response.set_response_http_code(200);
        response.set_response_length(response_body.size());

        vector<webserver::http_header> headers;
        headers.push_back(webserver::http_header{"Content-Type", "text/plain"});
        response.set_response_headers(headers);

        return response;
    };
```
 - Создайте веб хандлер, инициализировав его следующим образом:
```c++
 webserver::web_handler index_web_handler("/index", "GET", index_handler);
```

3. Поместите созданные обработчики в вектор
```c++
    handlers.emplace_back(index_web_handler);
```

4. Создайте веб сервер, указав порт и вектор с обработчиками
```c++
webserver::web_server server(PORT, handlers);
```

5. Запустите веб сервер
```c++
server.start();
```

## API Веб сервера

Функции для написания обработчиковв для девелоперов, использующих данный веб сервер:

### Request
Сервер предоставляет следующее API для работы с объектами типа **http_request**:

1) **get_request_body()**
Возвращает тело запроса в виде map<string, string>

Пример использования:



## Бенчмарки
Сравнение данного веб сервера и стандартного HTTP 1.1 веб сервера языка Go.
Сравнение производилось специальной программой, предназначенной для нагрузочного тестирования: https://github.com/blinky-z/ServerLoadTesting

Сырые данные, которые были обработаны и на основе их была произведена аналитика:
Данные были обработаны в Microsoft Excel 2016

Cравнение серверов будет производиться по таким показателям, как
* **Среднее время ответа**: Чем ниже - тем лучше
* **Медиана времени ответа**: Чем ниже - тем лучше
* **95 перцентиль времени ответа**: Чем ниже - тем лучше

### Тестирование с большим количеством клиентов (имитация реальной работы сайта)

**Условия тестирования:**
1) *Начальное количество клиентов*: 10
2) *Максимальное количество клиентов*: 300
3) *Постепенно добавляется по 10 клиентов до достижения лимита клиентов*
4) *Задержка между запросами*: 0.7 ms

#### Общее сравнение двух серверов:
В данном опыте сравниваются все показатели обоих серверов за все время работы сервера

![Общее сравнение двух серверов](https://i.imgur.com/sDAU7Zr.png)

#### Статистика роста среднего времени ответа в зависимости от количества клиентов:
В данном опыте сравнивается изменение среднего времени ответа сервера в соответствии с ростом клиентов. Чем медленнее растет показатель - тем лучше

![Статистика роста среднего времени ответа в зависимости от количества клиентов](https://i.imgur.com/EKQ7KfT.png)

#### Статистика роста медианы времени ответа в зависимости от количества клиентов:
В данном опыте сравнивается изменение медианты времени ответа сервера на рост клиентов. Чем медленнее растет показатель - тем лучше

![Статистика роста медианы времени ответа в зависимости от количества клиентов](https://i.imgur.com/ZQ2SZVG.png)

#### Статистика роста 95 перцентиля времени ответа в зависимости от количества клиентов.
В данном опыте сравнивается изменение 95 перцентиля времени ответа сервера на рост клиентов. Чем медленнее растет показатель - тем лучше

![Статистика роста 95 перцентиля времени ответа в зависимости от количества клиентов](https://i.imgur.com/R59Sw1B.png)

### Тестирование с большим количеством запросов с каждого клиента (имитация веб сервиса)

**Условия тестирования:**
1) *Начальное количество клиентов*: 8
2) *Количество клиентов фиксировано и не меняется*
4) *Задержка между запросами*: 0.3 ms

#### Общее сравнение двух серверов:
В данном опыте сравниваются все показатели обоих серверов за все время работы сервера

![Общее сравнение двух серверов](https://i.imgur.com/UlcoI11.png)

